from langchain import OpenAI, LLMMathChain
import os

#results - 112/222 correct - 50.45% accuracy

def get_file_contents(filename):
    try:
        with open(filename, 'r') as f:
            return f.read().strip()
    except FileNotFoundError:
        print("'%s' file not found" % filename)

api_key = get_file_contents('api_key.txt')

os.environ["OPENAI_API_KEY"] = api_key
llm = OpenAI(temperature = 0)
llm_math = LLMMathChain.from_llm(llm, verbose = True)

with open('declarative-math-word-problem/algebra222.csv') as f:
    questions = [i.split(',')[0] for i in f.readlines()]

with open('declarative-math-word-problem/algebra222.csv') as f:
    answers = [i.split(',')[1] for i in f.readlines()]

langchain_answers = []

for i in range(0, len(questions)):
    try:
        a = llm_math.run(questions[i])
        langchain_answers.append(a[8:])
    except ValueError:
        langchain_answers.append(a[8:])

print(langchain_answers)

langchain_answers = ['-21', '620', '9.57', '39', '8.93', '2633.0', '6800000000.0', '330', '110.0', '450', '-0.27', '9.0', '29', '760.0', '2.25', '3466.6666666666665', '21.84', '52.8', '280.0', '280.0', '28.333333333333336', '28.333333333333336', '30.0', '275.0', '74.28571428571429', '20.0', '260.0', '60.00000000000001', '1247.22', '5600.0', '280.0', '100', '63.0', '3.5', '1.3888888888888888', '8.0', '15.120000000000001', '0.8', '900.0', '97200.0', '25.0', '16.0', '16.0', '30.0', '60.0', '3.0', '3.0', '117.42857142857143', '0.6153846153846154', '39.6', '-105.0', '-75.33333333333333', '-75.33333333333333', '-75.33333333333333', '-75.33333333333333', '0.15', '0.9', '9.0', '6.0', '25.0', '25.0', '150.0', '5.0', '21280.0', '128000.0', '37.0', '300.0', '400.0', '20', '45', '72', '21', '-28', '187', '-3600', '0.35714285714285715', '3', '14.6', '68', '29', '29550', '11', '7', '21', '100.5', '121.19', '1.79', '16000.0', '6.0', '1.08', '36', '195000.0', '8.0', '5.0', '11.25', '75.0', '75.0', '161', '131.19', '32.0', '30.0', '125', '4.0', '4.0', '4.0', '12666.666666666666', '4', '5.0', '-5.0', '45', '1.25', '1080.0', '12.33', '4250.0', '50.0', '1.8867924528301845', '11.88', '259.8', '2424.242424242424', '2406.9767441860467', '175.0', '120.0', '18.0', '45.0', '25.0', '11.999999999999996', '200.0', '2.4999999999999947', '11.0', '21.212121212121218', '21.212121212121218', '-410.0', '-410.0', '6.5', '6.5', '6.5', '6.8', '38.0', '38.0', '30.34146341463415', '30.34146341463415', '30.34146341463415', '30.34146341463415', '30.34146341463415', '30.34146341463415', '50.0', '32.5', '-0.2', '-15.050167224080267', '-15.050167224080267', '85.42857142857143', '85.42857142857143', '2.6571428571428575', '24.0', '3.5', '-4.5', '-4.5', '116.0', '38', '167.5', '160.0', '120.0', '3.89', '875.0', '2.5', '2.5', '2.5', '-38.0', '-38.0', '-38.0', '-76.99999999999994', '150.0', '150.0', '16.0', '8.0', '8.0', '8.0', '600.0', '600.0', '600.0', '600.0', '290.0', '42.8', '526.6666666666666', '24', '19.5', '0.4166666666666667', '6.666666666666667', '347.0', '12000.0', '12000.0', '12000.0', '12000.0', '12000.0', '-30', '10.0', '8.0', '12.0', '-150.0', '2.4', '2.769230769230769', '240.0', '415.0', '11.454545454545455', '3.9999999999999987', '640.0', '-38.4', '-38.4', '-38.4', '-38.4', '-38.4', '42.0', '39.0', '177.5', '30.0', '9.6', '1600', '1600', '0.75', '2.4', '-113.5', '0.24096385542168677']

print(*langchain_answers, sep = '\n')
print(*answers, sep = "\n")